{% extends "base.html" %}
{% block title %}Benutzerverwaltung{% endblock %}
{% block content %}
<h1>Benutzerverwaltung</h1>

<section class="cards">
  <article class="card">
    <h3>Neuen Benutzer anlegen</h3>
    <form method="post">
      <input type="hidden" name="action" value="create">
      <label>Name <input name="username" required></label><br>
      <label>Passwort <input type="password" name="password" required></label><br>
      <label>Rolle
        <select name="role">
          <option value="user">User</option>
          <option value="editor">Editor</option>
          <option value="admin">Admin</option>
        </select>
      </label><br>
      <button type="submit">Anlegen</button>
    </form>
  </article>

  <article class="card">
    <h3>Vorhandene Benutzer</h3>
    <table class="tbl">
      <thead><tr><th>ID</th><th>Name</th><th>Rolle</th><th>Aktion</th></tr></thead>
      <tbody>
      {% for u in users %}
        <tr>
          <td>{{ u.id }}</td>
          <td>{{ u.username }}</td>
          <td>
            {% if u.username == 'admin' %}
              <em>admin</em>
            {% else %}
              <form method="post" style="display:inline;">
                <input type="hidden" name="action" value="update_role">
                <input type="hidden" name="user_id" value="{{ u.id }}">
                <select name="role">
                  <option value="user" {{ 'selected' if u.role=='user' else '' }}>user</option>
                  <option value="editor" {{ 'selected' if u.role=='editor' else '' }}>editor</option>
                  <option value="admin" {{ 'selected' if u.role=='admin' else '' }}>admin</option>
                </select>
                <button type="submit">Speichern</button>
              </form>
            {% endif %}
          </td>
          <td>
            {% if u.username != 'admin' %}
              <form method="post" style="display:inline" onsubmit="return confirm('Benutzer löschen?')">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="user_id" value="{{ u.id }}">
                <button type="submit">Löschen</button>
              </form>
            {% else %}
              <em>Standard-Admin</em>
            {% endif %}
          </td>
        </tr>
      {% else %}
        <tr><td colspan="4">Keine Benutzer vorhanden.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </article>
</section>
{% endblock %}
